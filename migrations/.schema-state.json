{
  "models": [
    {
      "name": "User",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "attributes": [
            "id",
            "default"
          ],
          "defaultValue": "gen_random_uuid()",
          "nullable": false
        },
        {
          "name": "email",
          "type": "VARCHAR",
          "attributes": [
            "unique"
          ],
          "length": 255,
          "nullable": false
        },
        {
          "name": "name",
          "type": "VARCHAR",
          "attributes": [],
          "length": 150,
          "nullable": false
        },
        {
          "name": "role",
          "type": "UserRole",
          "attributes": [
            "default"
          ],
          "defaultValue": "USER",
          "nullable": false
        },
        {
          "name": "age",
          "type": "SMALLINT",
          "attributes": [],
          "nullable": true
        },
        {
          "name": "balance",
          "type": "INTEGER",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "isActive",
          "type": "BOOLEAN",
          "attributes": [
            "default"
          ],
          "defaultValue": "true",
          "nullable": false
        },
        {
          "name": "createdAt",
          "type": "TIMESTAMP",
          "attributes": [
            "default"
          ],
          "defaultValue": "now()",
          "nullable": false
        },
        {
          "name": "updatedAt",
          "type": "TIMESTAMP",
          "attributes": [],
          "nullable": false
        }
      ],
      "relations": [
        {
          "name": "profile",
          "model": "Profile",
          "type": "one-to-one"
        },
        {
          "name": "orders",
          "model": "Order",
          "type": "one-to-many"
        }
      ],
      "rowLevelSecurity": {
        "enabled": true,
        "force": true
      },
      "policies": [
        {
          "name": "userIsolation",
          "for": [
            "select",
            "update"
          ],
          "to": "userRole",
          "using": "id = (SELECT current_setting('app.current_user_id')::uuid)"
        },
        {
          "name": "adminAccess",
          "for": "all",
          "to": "adminRole",
          "using": "true"
        }
      ],
      "triggers": [
        {
          "event": "BEFORE UPDATE",
          "level": "FOR EACH ROW",
          "execute": "IF (OLD.balance <> NEW.balance) THEN RAISE EXCEPTION 'Balance cannot be updated directly'; END IF;"
        }
      ],
      "indexes": [
        {
          "fields": [
            "role",
            "isActive"
          ]
        },
        {
          "fields": [
            "name"
          ],
          "name": "active_users_name_idx",
          "type": "btree",
          "where": "isActive = true"
        },
        {
          "fields": [
            "email"
          ],
          "unique": true,
          "where": "role = 'PUBLIC'"
        }
      ]
    },
    {
      "name": "Profile",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "attributes": [
            "id",
            "default"
          ],
          "defaultValue": "gen_random_uuid()",
          "nullable": false
        },
        {
          "name": "userId",
          "type": "UUID",
          "attributes": [
            "unique"
          ],
          "nullable": false
        },
        {
          "name": "bio",
          "type": "TEXT",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "avatar",
          "type": "VARCHAR",
          "attributes": [],
          "length": 255,
          "nullable": false
        },
        {
          "name": "location",
          "type": "POINT",
          "attributes": [],
          "nullable": false
        }
      ],
      "relations": [
        {
          "name": "UserProfile",
          "model": "User",
          "type": "one-to-one",
          "fields": [
            "userId"
          ],
          "references": [
            "id"
          ]
        }
      ],
      "policies": [],
      "triggers": [],
      "indexes": []
    },
    {
      "name": "Order",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "attributes": [
            "id",
            "default"
          ],
          "defaultValue": "gen_random_uuid()",
          "nullable": false
        },
        {
          "name": "userId",
          "type": "UUID",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "status",
          "type": "OrderStatus",
          "attributes": [
            "default"
          ],
          "defaultValue": "PENDING",
          "nullable": false
        },
        {
          "name": "totalAmount",
          "type": "DECIMAL",
          "attributes": [],
          "precision": 10,
          "scale": 2,
          "nullable": false
        },
        {
          "name": "items",
          "type": "JSONB",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "createdAt",
          "type": "TIMESTAMP",
          "attributes": [
            "default"
          ],
          "defaultValue": "now()",
          "nullable": false
        },
        {
          "name": "updatedAt",
          "type": "TIMESTAMP",
          "attributes": [],
          "nullable": false
        }
      ],
      "relations": [
        {
          "name": "user",
          "model": "User",
          "type": "one-to-one",
          "fields": [
            "userId"
          ],
          "references": [
            "id"
          ]
        },
        {
          "name": "products",
          "model": "ProductOrder",
          "type": "one-to-many"
        }
      ],
      "policies": [],
      "triggers": [],
      "indexes": [
        {
          "fields": [
            "userId"
          ]
        },
        {
          "fields": [
            "status",
            "createdAt"
          ],
          "name": "order_status_created_idx"
        }
      ]
    },
    {
      "name": "Log",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "attributes": [
            "id",
            "default"
          ],
          "defaultValue": "gen_random_uuid()",
          "nullable": false
        },
        {
          "name": "message",
          "type": "TEXT",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "createdAt",
          "type": "TIMESTAMP",
          "attributes": [
            "default"
          ],
          "defaultValue": "now()",
          "nullable": false
        }
      ],
      "relations": [],
      "policies": [],
      "triggers": [],
      "indexes": []
    },
    {
      "name": "Product",
      "fields": [
        {
          "name": "id",
          "type": "UUID",
          "attributes": [
            "id",
            "default"
          ],
          "defaultValue": "gen_random_uuid()",
          "nullable": false
        },
        {
          "name": "name",
          "type": "VARCHAR",
          "attributes": [],
          "length": 255,
          "nullable": false
        },
        {
          "name": "description",
          "type": "TEXT",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "price",
          "type": "DECIMAL",
          "attributes": [],
          "precision": 10,
          "scale": 2,
          "nullable": false
        },
        {
          "name": "stock",
          "type": "INTEGER",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "category",
          "type": "VARCHAR",
          "attributes": [],
          "length": 100,
          "nullable": false
        },
        {
          "name": "tags",
          "type": "TEXT[]",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "metadata",
          "type": "JSONB",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "createdAt",
          "type": "TIMESTAMP",
          "attributes": [
            "default"
          ],
          "defaultValue": "now()",
          "nullable": false
        },
        {
          "name": "updatedAt",
          "type": "TIMESTAMP",
          "attributes": [],
          "nullable": false
        }
      ],
      "relations": [
        {
          "name": "orders",
          "model": "ProductOrder",
          "type": "one-to-many"
        }
      ],
      "policies": [],
      "triggers": [
        {
          "event": "AFTER UPDATE",
          "level": "FOR EACH ROW",
          "execute": "IF (OLD.stock <> NEW.stock) THEN INSERT INTO Log (message) VALUES ('Tabela Product atualizada AFTER UPDATE'); RETURN NEW; END IF;"
        },
        {
          "event": "BEFORE UPDATE",
          "level": "FOR EACH ROW",
          "execute": "IF (OLD.price <> NEW.price) THEN INSERT INTO Log (message) VALUES ('Tabela Product atualizada BEFORE UPDATE'); RETURN NEW; END IF;"
        }
      ],
      "indexes": []
    },
    {
      "name": "ProductOrder",
      "fields": [
        {
          "name": "id",
          "type": "SERIAL",
          "attributes": [
            "id"
          ],
          "nullable": false
        },
        {
          "name": "orderId",
          "type": "UUID",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "productId",
          "type": "UUID",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "quantity",
          "type": "INTEGER",
          "attributes": [],
          "nullable": false
        },
        {
          "name": "price",
          "type": "DECIMAL",
          "attributes": [],
          "precision": 10,
          "scale": 2,
          "nullable": false
        }
      ],
      "relations": [
        {
          "name": "order",
          "model": "Order",
          "type": "one-to-one",
          "fields": [
            "orderId"
          ],
          "references": [
            "id"
          ]
        },
        {
          "name": "product",
          "model": "Product",
          "type": "one-to-one",
          "fields": [
            "productId"
          ],
          "references": [
            "id"
          ]
        }
      ],
      "policies": [],
      "triggers": [],
      "indexes": []
    }
  ],
  "enums": [
    {
      "name": "UserRole",
      "values": [
        "ADMIN",
        "USER",
        "PUBLIC"
      ]
    },
    {
      "name": "OrderStatus",
      "values": [
        "PENDING",
        "PROCESSING",
        "SHIPPED",
        "DELIVERED",
        "CANCELLED"
      ]
    }
  ],
  "extensions": [
    {
      "name": "pgcrypto",
      "version": "1.3"
    },
    {
      "name": "postgis"
    },
    {
      "name": "uuid-ossp"
    }
  ],
  "roles": [
    {
      "name": "userRole",
      "privileges": [
        {
          "privileges": [
            "select",
            "insert",
            "update"
          ],
          "on": "User"
        }
      ]
    },
    {
      "name": "adminRole",
      "privileges": [
        {
          "privileges": [
            "select",
            "insert",
            "update",
            "delete"
          ],
          "on": "User"
        }
      ]
    }
  ]
}